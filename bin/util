#!/bin/bash

DIR=$(cd $(dirname $0); pwd)
WORK_DIR="$(cd $DIR/..; pwd)"

. "${DIR}/common.sh"

# methods ==================================================
sample() {
  # データが存在するとき
  if [ -n "$1" ]; then
    echo_info "$@"
  else
    run_with_echo analyze_os
    echo_info "no args. sample echo OS: $OS"
  fi

  cd_work_dir
  run_with_echo pwd
}

cd_work_dir() {
  run_with_echo cd $WORK_DIR
}

create_venv() {
  cd_work_dir
  if [ ! -d ".venv" ]; then
    run_with_echo python -m venv .venv
  fi
  run_with_echo source .venv/Scripts/activate
}

pip_install() {
  run_with_echo python -m pip install -U pip

  if [ -n "$1" ]; then
    run_with_echo pip install -U "$1"
  else
    run_with_echo pip install -U -r requirements.txt
  fi

  run_with_echo pip freeze
}

# exec  ==================================================
HELP=`cat << 'EOF'
Usage: $0 command

Commands:
  setup             : setup venv

Python:
  pip_install [arg] : pip install specific package. (defaul=requirements.txt)

EOF
`

cmd=$1
shift
case "$cmd" in
  setup)  create_venv && pip_install ;;
  pip_install)  pip_install "$@" ;;

  *)
    echo "$HELP"
    exit 2
  ;;
esac