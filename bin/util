#!/bin/bash

DIR=$(cd $(dirname $0); pwd)
WORK_DIR="$(cd $DIR/..; pwd)"

. "${DIR}/common.sh"

# methods ==================================================
sample() {
  # データが存在するとき
  if [ -n "$1" ]; then
    echo_info "$@"
  else
    run_with_echo analyze_os
    echo_info "no args. sample echo OS: $OS"
  fi

  cd_work_dir
  run_with_echo pwd
}

cd_work_dir() {
  run_with_echo cd $WORK_DIR
}

create_venv() {
  cd_work_dir
  if [ ! -d ".venv" ]; then
    run_with_echo python -m venv .venv
  fi
  run_with_echo source .venv/Scripts/activate
}

pip_install() {
  run_with_echo python -m pip install -U pip

  if [ -n "$1" ]; then
    run_with_echo pip install -U "$1"
  else
    run_with_echo pip install -U -r requirements.txt
  fi

  run_with_echo pip freeze
}

create_project() {
  _NAME="$1"
  if [ "$_NAME" == "" ]; then
    echo_warn no project name
    echo_help
    exit 1
  fi

  echo_warn django-admin startproject $_NAME .

  (cd $_NAME && find . )
}

# exec  ==================================================
HELP=`cat << 'EOF'
Usage: $0 command

Commands:
  setup                         : setup venv
  create_project {project name} : create_project

Python:
  pip_install [packge]  : pip install specific package. (defaul=requirements.txt)

EOF
`
echo_help() {
  echo "$HELP"
}

cmd=$1
shift
case "$cmd" in
  setup)  create_venv && pip_install ;;
  create_project) create_project "$@" ;;

  pip_install)  pip_install "$@" ;;

  *)
    echo_help
    exit 2
  ;;
esac